@page
@model PanoramaApp.Pages.Groups.InvitationsModel
@using PanoramaApp.Data
@{
    ViewData["Title"] = "Group Invitations";
}

<div class="container mt-4">
    <h2 class="mb-4">Group Invitations</h2>

    @if (Model.Invitations.Any())
    {
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Group</th>
                        <th>Invited by</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var invitation in Model.Invitations)
                    {
                        var group = Model.Groups.FirstOrDefault(g => g.Id == invitation.GroupId);
                        var inviter = Model.Users.FirstOrDefault(u => u.Id == invitation.InvitedByUserId);

                        <tr>
                            <td>@group?.Name</td>
                            <td>@inviter?.UserName</td>
                            <td>
                                <form method="post" asp-page-handler="Accept" class="d-inline">
                                    <input type="hidden" name="invitationId" value="@invitation.Id" />
                                    <button type="submit" class="btn btn-success btn-sm">Accept</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <p class="text-muted">No new invitations.</p>
    }

    <h3 class="mt-5">Invite New Member</h3>
    <form method="post" asp-page-handler="Invite" class="mt-3">
        <div class="mb-3">
            <label for="group" class="form-label">Choose group:</label>
            <select id="group" name="groupId" class="form-select">
                @foreach (var group in Model.Groups)
                {
                    <option value="@group.Id">@group.Name</option>
                }
            </select>
        </div>
        <div class="mb-3">
            <label for="user" class="form-label">Choose user:</label>
            <select id="user" name="invitedUserId" class="form-select">
                @foreach (var user in Model.Users)
                {
                    @if (user.Id != Model.CurrentUserId)
                    {
                        <option value="@user.Id">@user.UserName</option>
                    }
                }
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Invite</button>
    </form>
</div>
