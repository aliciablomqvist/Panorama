@page "{movieListId:int}"
@model PanoramaApp.Pages.MovieLists.PrioritizeModel

<h2>Prioritera Filmer i Lista @Model.MovieListId</h2>

<ul id="movieList">
    @foreach (var movie in Model.Movies)
    {
        <li draggable="true" data-id="@movie.Id" class="draggable">
            <strong>@movie.Title</strong> - Prioritet: @movie.Priority
        </li>
    }
</ul>

<button id="savePriority" class="btn btn-primary">Spara Prioritering</button>

@section Scripts {
    <script>
        const movieListId = @Model.MovieListId;

        // Exempel: logik för drag-and-drop kan läggas till senare

        document.getElementById('savePriority').addEventListener('click', async () => {
            const movieElements = [...document.querySelectorAll('#movieList li')];
            const updates = movieElements.map((el, index) => ({
                id: parseInt(el.getAttribute('data-id'), 10),
                priority: movieElements.length - index
            }));

            const response = await fetch(`/Prioritize/${movieListId}?handler=SavePriorities`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updates)
            });

            if (response.ok) {
                alert('Prioritering sparad!');
            } else {
                alert('Ett fel uppstod vid sparandet av prioriteringen.');
            }
        });
    </script>
}
